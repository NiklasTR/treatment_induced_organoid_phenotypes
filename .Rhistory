geom_point_rast(data = umap_tidy %>%
#filter(drug == "DMSO" | grepl(drug, pattern = "Bortezomib")) %>%
filter(grepl(drug, pattern = "Bortezomib")) %>%
filter(line %in% c("D055T01", "D054T01", "D046T01")) %>%
mutate(concentration = if_else(concentration == "nan", "0", concentration)) %>%
mutate(drug = factor(drug, levels =drug_order)) %>%
group_by(drug) %>%
sample_n(5000, replace = TRUE),
aes(color = drug),alpha = 1, size = 1.5, shape=16, color = "black") +
facet_wrap( ~ concentration, ncol = 1) +
#scale_color_brewer(type = "seq", palette = "YlOrRd") +
#geom_density2d(color = "black") +
theme_classic() +
labs(x = "UMAP 1",
y = "UMAP 2")+
#caption = "control treated organoids") +
theme(legend.position = "bottom") +
theme_cowplot(font_size = 8) +
theme(legend.position = "bottom")
gg_bortezomib
gg_bortezomib + ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_bortezomib.pdf"), width = 2, height = 8)
create_princurve_trace <- function(df){
df_tmp_init <- df %>%
group_by(concentration) %>%
summarize(v1 = mean(v1),
v2 = mean(v2)) %>%
ungroup()
fit <- principal_curve(x = df %>% dplyr::select(v1, v2) %>% as.matrix(),
start = df_tmp_init %>% dplyr::select(v1, v2) %>% as.matrix(),
approx_points = FALSE,
trace = TRUE,
plot_iterations = FALSE,
maxit = 30,
stretch =2)
plot(fit)
points(df_tmp_init%>% dplyr::select(v1, v2) %>% as.matrix())
result <- list()
result$fit <- fit$s[fit$ord,] %>% as_tibble()
result$center <- df_tmp_init
result$input <- df
return(result)
}
set.seed(123)
drug_order <- umap_tidy %>%
filter(drug == "DMSO" | grepl(drug, pattern = "Trametinib")| grepl(drug, pattern = "Bortezomib")) %>%
filter(!grepl(drug, pattern = "Dabrafenib")) %>%
filter(!grepl(drug, pattern = "GSK1120212")) %>% .$drug %>% unique() %>% sort()
center_df <- umap_tidy %>%
filter(drug %in% drug_order) %>%
#filter(line %in% c("D055T01", "D054T01", "D046T01")) %>%
dplyr::select(v1, v2, drug, line) %>%
group_by(drug, line) %>%
summarize(v1 = mean(v1),
v2 = mean(v2)) %>%
separate(drug, c("drug", "concentration"), sep = "__") %>%
mutate(concentration = as.numeric(concentration),
drug_line = paste0(drug, "_", line))
gg_trambort <- center_df %>%
ggplot(aes(v1, v2)) +
geom_point_rast(data = umap_tidy %>% sample_frac(0.01) %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point(aes(color = drug, group = drug_line),alpha = 1, size = 1.5, shape=16) +
geom_smooth(aes(group = drug, color = drug), se = FALSE) +
#geom_path(aes(group = drug, color = drug), arrow = arrow(angle =15, ends = "last", type = "closed", length = unit(0.15, "inches"))) +
#geom_path(aes(group = drug_line, color = drug)) +
scale_color_manual(values = c("#707070", "#000000", "#4285F4")) +
theme_classic() +
labs(x = "UMAP 1",
y = "UMAP 2")+
#caption = "control treated organoids") +
theme(legend.position = "bottom") +
theme_cowplot()
gg_trambort
drug_order <- c("Trametinib")
center_df <- umap_tidy %>%
filter(drug %in% drug_order) %>%
filter(line %in% c("D055T01", "D054T01", "D046T01")) %>% #, "D027T01", "D019T01"
mutate(drug = factor(drug, levels =drug_order)) %>%
arrange((drug)) %>%
group_by(drug, line, concentration) %>%
sample_n(200, replace = TRUE) %>% ungroup() # adjust based on pan-line vs.
plot_df <- center_df %>%
nest(-line, -drug) %>%
mutate(plot = purrr::map(data, ~ create_princurve_trace(.x)))
gg_tram_traj <-
ggplot() +
geom_point_rast(aes(v1, v2), data = umap_tidy %>% sample_frac(0.01) %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point(data = plot_df %>% unnest(data),
aes(color = line, v1, v2), alpha = 0.5, size = 0.35) +
geom_path(data = plot_df %>% mutate(plot_trace = purrr::map(plot, ~ .x$fit %>% .[, ])) %>% unnest(plot_trace),
aes(v1, v2, group = paste0(drug, line), color = line), size = 1.5,
arrow = arrow(angle = 10, ends = "last", type = "closed", length = unit(0.15, "inches")))+
scale_color_brewer(type = "qual", palette = "Set2") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "bottom") +
facet_wrap(~ drug)
gg_tram_traj + ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_tram_traj.pdf"), width = 4, height = 4)
drug_order <- c("Trametinib")
center_df <- umap_tidy %>%
filter(drug %in% drug_order) %>%
filter(line %in% c("D027T01")) %>%
mutate(drug = factor(drug, levels =drug_order)) %>%
arrange((drug)) %>%
group_by(drug, line, concentration) %>%
sample_n(200, replace = TRUE) %>% ungroup() # adjust based on pan-line vs.
plot_df <- center_df %>%
nest(-line, -drug) %>%
mutate(plot = purrr::map(data, ~ create_princurve_trace(.x)))
gg_tram_traj <-
ggplot() +
geom_point_rast(aes(v1, v2), data = umap_tidy %>% sample_frac(0.01) %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point(data = plot_df %>% unnest(data),
aes(color = line, v1, v2), alpha = 0.5, size = 0.35) +
geom_path(data = plot_df %>% mutate(plot_trace = purrr::map(plot, ~ .x$fit %>% .[, ])) %>% unnest(plot_trace),
aes(v1, v2, group = paste0(drug, line), color = line), size = 1.5,
arrow = arrow(angle = 10, ends = "last", type = "closed", length = unit(0.15, "inches")))+
scale_color_brewer(type = "qual", palette = "Set2") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "bottom") +
facet_wrap(~ drug)
gg_tram_traj + ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_tram_traj_d027t01.pdf"), width = 4, height = 4)
drug_order <- c("WYE-132", "DMSO")
center_df <- umap_tidy %>%
filter(drug %in% drug_order) %>%
filter(line %in% c("D030T01", "D027T01", "D013T01")) %>%
group_by(drug, line, concentration) %>%
sample_n(700, replace = TRUE) %>% ungroup()
gg_mtor_all <- umap_tidy %>%
filter(drug == "DMSO" | grepl(drug, pattern = "WYE-132")) %>%
filter(line %in% c("D030T01", "D027T01", "D013T01")) %>%
group_by(drug) %>%
sample_n(700) %>%
ggplot(aes(v1, v2)) +
geom_point_rast(data = umap_sampled %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point_rast(aes(color = drug),alpha = 1, size = 1, shape=16, color = "black") +
facet_wrap(~ drug) +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "nothing")
gg_mtor_all + ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_mtor.pdf"), width = 6, height = 3)
drug_order <- c("Chir9902", "DMSO")
center_df <- umap_tidy %>%
filter(drug %in% drug_order) %>%
#filter(line %in% c("D030T01", "D027T01", "D013T01")) %>%
group_by(drug, line, concentration) %>%
sample_n(200, replace = TRUE) %>% ungroup()
gg_mtor_all <- umap_tidy %>%
filter(drug == "DMSO" | grepl(drug, pattern = drug_order[1])) %>%
#filter(line %in% c("D030T01", "D027T01", "D013T01")) %>%
group_by(drug) %>%
sample_n(200) %>%
ggplot(aes(v1, v2)) +
geom_point_rast(data = umap_sampled %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point_rast(aes(color = drug),alpha = 1, size = 1, shape=16, color = "black") +
facet_wrap(~ drug) +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "nothing")
gg_mtor_all + ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_gsk.pdf"), width = 6, height = 3)
gg_size_dist + ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_size_dist.pdf"))
gg_size_dist_log +  ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_size_dist_log.pdf"))
ggdrug_size + ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_drug_dist_size_log.pdf"))
gg_ecdf + ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_size_dist_ecdf.pdf"))
gg_drug + ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_drug.pdf"),
width = 8, height = 4)
gg_size_drug + ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_trametinib_size_dose.pdf"), width = 3.65, height = 3.65)
knitr::knit_exit()
library(mixtools)
df_mix <- normalmixEM(umap_tidy$size_log, k = 2)
umap_tidy$drug %>% table()
drug_order <- c("CHIR-98014", "DMSO")
center_df <- umap_tidy %>%
filter(drug %in% drug_order) %>%
#filter(line %in% c("D030T01", "D027T01", "D013T01")) %>%
group_by(drug, line, concentration) %>%
sample_n(200, replace = TRUE) %>% ungroup()
gg_mtor_all <- umap_tidy %>%
filter(drug == "DMSO" | grepl(drug, pattern = drug_order[1])) %>%
#filter(line %in% c("D030T01", "D027T01", "D013T01")) %>%
group_by(drug) %>%
sample_n(200) %>%
ggplot(aes(v1, v2)) +
geom_point_rast(data = umap_sampled %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point_rast(aes(color = drug),alpha = 1, size = 1, shape=16, color = "black") +
facet_wrap(~ drug) +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "nothing")
gg_mtor_all + ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_gsk.pdf"), width = 6, height = 3)
drug_order <- c("CHIR-98014", "DMSO")
center_df <- umap_tidy %>%
filter(drug %in% drug_order) %>%
#filter(line %in% c("D030T01", "D027T01", "D013T01")) %>%
group_by(drug, line, concentration) %>%
sample_n(500, replace = TRUE) %>% ungroup()
gg_mtor_all <- umap_tidy %>%
filter(drug == "DMSO" | grepl(drug, pattern = drug_order[1])) %>%
#filter(line %in% c("D030T01", "D027T01", "D013T01")) %>%
group_by(drug) %>%
sample_n(500) %>%
ggplot(aes(v1, v2)) +
geom_point_rast(data = umap_sampled %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point_rast(aes(color = drug),alpha = 1, size = 1, shape=16, color = "black") +
facet_wrap(~ drug) +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "nothing")
gg_mtor_all + ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_gsk.pdf"), width = 6, height = 3)
set.seed(123)
drug_order <- c("CHIR-98014", "DMSO")
center_df <- umap_tidy %>%
filter(drug %in% drug_order) %>%
#filter(line %in% c("D030T01", "D027T01", "D013T01")) %>%
group_by(drug, line, concentration) %>%
sample_n(500, replace = TRUE) %>% ungroup()
gg_mtor_all <- umap_tidy %>%
filter(drug == "DMSO" | grepl(drug, pattern = drug_order[1])) %>%
#filter(line %in% c("D030T01", "D027T01", "D013T01")) %>%
group_by(drug) %>%
sample_n(500) %>%
ggplot(aes(v1, v2)) +
geom_point_rast(data = umap_sampled %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point_rast(aes(color = drug),alpha = 1, size = 1, shape=16, color = "black") +
facet_wrap(~ drug) +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "nothing")
gg_mtor_all + ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_gsk.pdf"), width = 6, height = 3)
drug_order <- c("Trametinib")
center_df <- umap_tidy %>%
filter(drug %in% drug_order) %>%
filter(line %in% c("D027T01", "D019T01")) %>%
mutate(drug = factor(drug, levels =drug_order)) %>%
arrange((drug)) %>%
group_by(drug, line, concentration) %>%
sample_n(200, replace = TRUE) %>% ungroup() # adjust based on pan-line vs.
plot_df <- center_df %>%
nest(-line, -drug) %>%
mutate(plot = purrr::map(data, ~ create_princurve_trace(.x)))
gg_tram_traj <-
ggplot() +
geom_point_rast(aes(v1, v2), data = umap_tidy %>% sample_frac(0.01) %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point(data = plot_df %>% unnest(data),
aes(color = line, v1, v2), alpha = 0.5, size = 0.35) +
geom_path(data = plot_df %>% mutate(plot_trace = purrr::map(plot, ~ .x$fit %>% .[, ])) %>% unnest(plot_trace),
aes(v1, v2, group = paste0(drug, line), color = line), size = 1.5,
arrow = arrow(angle = 10, ends = "last", type = "closed", length = unit(0.15, "inches")))+
scale_color_brewer(type = "qual", palette = "Set2") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "bottom") +
facet_wrap(~ drug)
gg_tram_traj + ggsave(paste0(PATH, "notebooks/PhenotypeSpectrum/gg_tram_traj_d027t01.pdf"), width = 4, height = 4)
PATH
set.seed()
set.seed(123)
df %>%
filter(drug == "DMSO") %>%
sample_n(10000) %>%
ggplot(aes(v1, v2, color = actin)) +
geom_point_rast(alpha = 0.75, size = 0.35) +
scale_colour_gradient(low = "white", high = "red") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2",
title = "Permeability intensity") +
theme(legend.position = "bottom") +
ggsave(paste0(PATH, "results/figures/gg_actin.pdf"), width = 4, height = 4)
set.seed(123)
df %>%
filter(drug == "DMSO") %>%
sample_n(10000) %>%
ggplot(aes(v1, v2, color = actin)) +
geom_point_rast(alpha = 0.75, size = 0.35) +
scale_colour_gradient(low = "white", high = "red") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2",
title = "Permeability intensity") +
theme(legend.position = "bottom") +
ggsave(paste0(PATH, "reports/figures/gg_actin.pdf"), width = 4, height = 4)
df %>%
filter(drug == "DMSO") %>%
sample_n(10000) %>%
ggplot(aes(v1, v2, color = dapi)) +
geom_point_rast(alpha = 0.75, size = 0.35) +
scale_colour_gradient(low = "white", high = "blue") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2",
title = "Permeability intensity") +
theme(legend.position = "bottom") +
ggsave(paste0(PATH, "reports/figures/gg_dapi.pdf"), width = 4, height = 4)
set.seed(123)
df %>%
filter(drug == "DMSO") %>%
sample_n(10000) %>%
ggplot(aes(v1, v2, color = actin)) +
geom_point_rast(alpha = 0.75, size = 0.35) +
scale_colour_gradient(low = "white", high = "red") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2",
title = "Actin staining intensity") +
theme(legend.position = "bottom") +
ggsave(paste0(PATH, "reports/figures/gg_actin.pdf"), width = 4, height = 4)
df %>%
filter(drug == "DMSO") %>%
sample_n(10000) %>%
ggplot(aes(v1, v2, color = dapi)) +
geom_point_rast(alpha = 0.75, size = 0.35) +
scale_colour_gradient(low = "white", high = "blue") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2",
title = "Nuclear staining intensity") +
theme(legend.position = "bottom") +
ggsave(paste0(PATH, "reports/figures/gg_dapi.pdf"), width = 4, height = 4)
drug_order <- c("Trametinib")
center_df <- umap_tidy %>%
filter(drug %in% drug_order) %>%
filter(line %in% c("D027T01", "D019T01")) %>%
mutate(drug = factor(drug, levels =drug_order)) %>%
arrange((drug)) %>%
group_by(drug, line, concentration) %>%
sample_n(200, replace = TRUE) %>% ungroup() # adjust based on pan-line vs.
plot_df <- center_df %>%
nest(-line, -drug) %>%
mutate(plot = purrr::map(data, ~ create_princurve_trace(.x)))
gg_tram_traj <-
ggplot() +
geom_point_rast(aes(v1, v2), data = umap_tidy %>% sample_frac(0.01) %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point(data = plot_df %>% unnest(data),
aes(color = line, v1, v2), alpha = 0.5, size = 0.35) +
geom_path(data = plot_df %>% mutate(plot_trace = purrr::map(plot, ~ .x$fit %>% .[, 50])) %>% unnest(plot_trace),
aes(v1, v2, group = paste0(drug, line), color = line), size = 1.5,
arrow = arrow(angle = 10, ends = "last", type = "closed", length = unit(0.15, "inches")))+
scale_color_brewer(type = "qual", palette = "Set2") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "bottom") +
facet_wrap(~ drug)
set.seed(123)
drug_order <- c("Trametinib")
center_df <- umap_tidy %>%
filter(drug %in% drug_order) %>%
filter(line %in% c("D027T01", "D019T01")) %>%
mutate(drug = factor(drug, levels =drug_order)) %>%
arrange((drug)) %>%
group_by(drug, line, concentration) %>%
sample_n(400, replace = TRUE) %>% ungroup() # adjust based on pan-line vs.
plot_df <- center_df %>%
nest(-line, -drug) %>%
mutate(plot = purrr::map(data, ~ create_princurve_trace(.x)))
gg_tram_traj <-
ggplot() +
geom_point_rast(aes(v1, v2), data = umap_tidy %>% sample_frac(0.01) %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point(data = plot_df %>% unnest(data),
aes(color = line, v1, v2), alpha = 0.5, size = 0.35) +
geom_path(data = plot_df %>% mutate(plot_trace = purrr::map(plot, ~ .x$fit %>% .[, 50])) %>% unnest(plot_trace),
aes(v1, v2, group = paste0(drug, line), color = line), size = 1.5,
arrow = arrow(angle = 10, ends = "last", type = "closed", length = unit(0.15, "inches")))+
scale_color_brewer(type = "qual", palette = "Set2") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "bottom") +
facet_wrap(~ drug)
set.seed(123)
drug_order <- c("Trametinib")
center_df <- umap_tidy %>%
filter(drug %in% drug_order) %>%
filter(line %in% c("D027T01", "D019T01")) %>%
mutate(drug = factor(drug, levels =drug_order)) %>%
arrange((drug)) %>%
group_by(drug, line, concentration) %>%
sample_n(400, replace = TRUE) %>% ungroup() # adjust based on pan-line vs.
plot_df <- center_df %>%
nest(-line, -drug) %>%
mutate(plot = purrr::map(data, ~ create_princurve_trace(.x)))
gg_tram_traj <-
ggplot() +
geom_point_rast(aes(v1, v2), data = umap_tidy %>% sample_frac(0.01) %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point(data = plot_df %>% unnest(data),
aes(color = line, v1, v2), alpha = 0.5, size = 0.35) +
geom_path(data = plot_df %>% mutate(plot_trace = purrr::map(plot, ~ .x$fit %>% .[, 50])) %>% unnest(plot_trace),
aes(v1, v2, group = paste0(drug, line), color = line), size = 1.5,
arrow = arrow(angle = 10, ends = "last", type = "closed", length = unit(0.15, "inches")))+
scale_color_brewer(type = "qual", palette = "Set2") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "bottom") +
facet_wrap(~ drug)
gg_tram_traj <-
ggplot() +
geom_point_rast(aes(v1, v2), data = umap_tidy %>% sample_frac(0.01) %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point(data = plot_df %>% unnest(data),
aes(color = line, v1, v2), alpha = 0.5, size = 0.35) +
geom_path(data = plot_df %>% mutate(plot_trace = purrr::map(plot, ~ .x$fit %>% .[,])) %>% unnest(plot_trace),
aes(v1, v2, group = paste0(drug, line), color = line), size = 1.5,
arrow = arrow(angle = 10, ends = "last", type = "closed", length = unit(0.15, "inches")))+
scale_color_brewer(type = "qual", palette = "Set2") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "bottom") +
facet_wrap(~ drug)
gg_tram_traj
gg_tram_traj <-
ggplot() +
geom_point_rast(aes(v1, v2), data = umap_tidy %>% sample_frac(0.01) %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point(data = plot_df %>% unnest(data),
aes(color = line, v1, v2), alpha = 0.5, size = 0.35) +
geom_path(data = plot_df %>% mutate(plot_trace = purrr::map(plot, ~ .x$fit %>% .[1:50,])) %>% unnest(plot_trace),
aes(v1, v2, group = paste0(drug, line), color = line), size = 1.5,
arrow = arrow(angle = 10, ends = "last", type = "closed", length = unit(0.15, "inches")))+
scale_color_brewer(type = "qual", palette = "Set2") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "bottom") +
facet_wrap(~ drug)
gg_tram_traj + ggsave(paste0(PATH, "reports/figures/gg_tram_traj_D27_D19.pdf"), width = 4, height = 4)
gg_tram_traj <-
ggplot() +
geom_point_rast(aes(v1, v2), data = umap_tidy %>% sample_frac(0.01) %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point(data = plot_df %>% unnest(data),
aes(color = line, v1, v2), alpha = 0.5, size = 0.35) +
geom_path(data = plot_df %>% mutate(plot_trace = purrr::map(plot, ~ .x$fit %>% .[1:500,])) %>% unnest(plot_trace),
aes(v1, v2, group = paste0(drug, line), color = line), size = 1.5,
arrow = arrow(angle = 10, ends = "last", type = "closed", length = unit(0.15, "inches")))+
scale_color_brewer(type = "qual", palette = "Set2") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "bottom") +
facet_wrap(~ drug)
gg_tram_traj
gg_tram_traj <-
ggplot() +
geom_point_rast(aes(v1, v2), data = umap_tidy %>% sample_frac(0.01) %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point(data = plot_df %>% unnest(data),
aes(color = line, v1, v2), alpha = 0.5, size = 0.35) +
geom_path(data = plot_df %>% mutate(plot_trace = purrr::map(plot, ~ .x$fit %>% .[1:1500,])) %>% unnest(plot_trace),
aes(v1, v2, group = paste0(drug, line), color = line), size = 1.5,
arrow = arrow(angle = 10, ends = "last", type = "closed", length = unit(0.15, "inches")))+
scale_color_brewer(type = "qual", palette = "Set2") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "bottom") +
facet_wrap(~ drug)
gg_tram_traj
set.seed(123)
drug_order <- c("Trametinib")
center_df <- umap_tidy %>%
filter(drug %in% drug_order) %>%
filter(line %in% c("D027T01")) %>%
mutate(drug = factor(drug, levels =drug_order)) %>%
arrange((drug)) %>%
group_by(drug, line, concentration) %>%
sample_n(400, replace = TRUE) %>% ungroup() # adjust based on pan-line vs.
plot_df <- center_df %>%
nest(-line, -drug) %>%
mutate(plot = purrr::map(data, ~ create_princurve_trace(.x)))
gg_tram_traj <-
ggplot() +
geom_point_rast(aes(v1, v2), data = umap_tidy %>% sample_frac(0.01) %>% dplyr::select(-drug), alpha = 1, size = 0.35, color = "#f1f1f1") +
geom_point(data = plot_df %>% unnest(data),
aes(color = line, v1, v2), alpha = 0.5, size = 0.35) +
geom_path(data = plot_df %>% mutate(plot_trace = purrr::map(plot, ~ .x$fit %>% .[1:1500,])) %>% unnest(plot_trace),
aes(v1, v2, group = paste0(drug, line), color = line), size = 1.5,
arrow = arrow(angle = 10, ends = "last", type = "closed", length = unit(0.15, "inches")))+
scale_color_brewer(type = "qual", palette = "Set2") +
theme_cowplot() +
labs(x = "UMAP 1",
y = "UMAP 2")+
theme(legend.position = "bottom") +
facet_wrap(~ drug)
gg_tram_traj + ggsave(paste0(PATH, "reports/figures/gg_tram_traj_D27_D19.pdf"), width = 4, height = 4)
library(tidyverse)
library(monocle3)
library(tidyverse)
install.packages("tidyverse")
install.packages("tidyverse")
library(tidyverse)
library(tidyverse)
library(dplyr)
library(dplyr)
?read_rds
??read_rds
library(here)
here::here()
library(monocle3)
obj <- readRDS(obj_graph, paste0(PATH, "data/processed/PhenotypeSpectrum/louvain_absolute_all_drugs_", length_in))
length_in <- 1e-7
obj <- readRDS(paste0(PATH, "data/processed/PhenotypeSpectrum/louvain_absolute_all_drugs_", length_in))
plot_cells(obj)
plot_cells(obj)
plot_cells(obj)
plot_cells(obj)
